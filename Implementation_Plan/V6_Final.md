# è·¨å¹³å°æ”¯ä»˜è®°è´¦åˆ†æå·¥å…·å®æ–½æ–¹æ¡ˆï¼ˆV6 Â· Finalï¼‰

---

## èŒƒå›´

| é‡Œç¨‹ç¢‘ | è¦†ç›–å¹³å° | æ ¸å¿ƒèƒ½åŠ› |
|---|---|---|
| **V1 MVP** ï¼ˆå·²å®Œæˆï¼‰ | æ”¯ä»˜å® + å¾®ä¿¡ | è§£æ â†’ é€€æ¬¾å¯¹å†² â†’ åŒè½¨åˆ†æµ â†’ LLM æ‰“æ ‡ â†’ Web UI |
| **V6 å¢é‡** ï¼ˆæœ¬æ¬¡ï¼‰ | + **äº¬ä¸œ + ç¾å›¢** | æ–°å¢ä¸¤å¹³å° Parser â†’ å„è‡ªé€€æ¬¾å¯¹å†² â†’ å„è‡ªåŒè½¨åˆ†æµ â†’ **ç»Ÿä¸€ LLM æ‰“æ ‡** â†’ åˆ†ç±»ä½“ç³»æ‰©å…… |

æŠ€æœ¯æ ˆï¼šPython åç«¯ï¼ˆpandas + Flaskï¼‰Â· Vite å‰ç«¯ï¼ˆChart.jsï¼‰Â· LLM æ‰“æ ‡ç”± Agent è‡ªèº«æ‰§è¡Œ

---

## ä¸€ã€æ•°æ®è§£æ

### æ”¯ä»˜å® â€” GB2312 CSVï¼ˆå·²å®ç°ï¼‰

- å‰ 24 è¡Œå…ƒæ•°æ®ï¼Œç¬¬ 25 è¡Œè¡¨å¤´ï¼Œ2009 ç¬”
- å­—æ®µï¼šäº¤æ˜“æ—¶é—´ / **äº¤æ˜“åˆ†ç±»** âœ… / äº¤æ˜“å¯¹æ–¹ / å•†å“è¯´æ˜ / æ”¶/æ”¯ / é‡‘é¢ / æ”¶/ä»˜æ¬¾æ–¹å¼ / äº¤æ˜“çŠ¶æ€ / äº¤æ˜“è®¢å•å· / å•†å®¶è®¢å•å·

### å¾®ä¿¡ â€” XLSX Â· 4 å­£åº¦æ–‡ä»¶ï¼ˆå·²å®ç°ï¼‰

- å‰ 16 è¡Œå…ƒæ•°æ®ï¼Œç¬¬ 17 è¡Œè¡¨å¤´ï¼Œçº¦ 420 ç¬”
- å­—æ®µï¼šäº¤æ˜“æ—¶é—´ / **äº¤æ˜“ç±»å‹** âš ï¸ / äº¤æ˜“å¯¹æ–¹ / å•†å“ / æ”¶/æ”¯ / é‡‘é¢(å…ƒ)ï¼ˆå¸¦ `Â¥`ï¼‰/ æ”¯ä»˜æ–¹å¼ / å½“å‰çŠ¶æ€ / äº¤æ˜“å•å· / å•†æˆ·å•å·
- **æ— æ¶ˆè´¹åˆ†ç±»**ï¼Œéœ€ LLM æ‰“æ ‡

### äº¬ä¸œ â€” CSVï¼ˆV6 æ–°å¢ï¼‰

- å‰ 21 è¡Œå…ƒæ•°æ®ä¸æç¤ºï¼Œç¬¬ 22 è¡Œä¸ºçœŸæ­£è¡¨å¤´
- å­—æ®µï¼šäº¤æ˜“æ—¶é—´ / **å•†æˆ·åç§°** / **äº¤æ˜“è¯´æ˜** / **é‡‘é¢** / æ”¶/ä»˜æ¬¾æ–¹å¼ / äº¤æ˜“çŠ¶æ€ / **æ”¶/æ”¯** / **äº¤æ˜“åˆ†ç±»** âœ… / äº¤æ˜“è®¢å•å· / å•†å®¶è®¢å•å· / å¤‡æ³¨
- å¹³å°è‡ªå¸¦åˆ†ç±»è¾ƒç»†ï¼ˆåŒ»ç–—ä¿å¥ã€è¿åŠ¨æˆ·å¤–ã€é‹æœç®±åŒ…ç­‰ï¼‰ï¼Œä½†**ä¸ç›´æ¥ä¿¡èµ–**ï¼Œç»Ÿä¸€èµ° LLM æ‰“æ ‡
- é‡‘é¢å­—æ®µå¯èƒ½åŒ…å«é€€æ¬¾ä¿¡æ¯ï¼ˆå¦‚ `293.10(å·²å…¨é¢é€€æ¬¾)` æˆ– `2977.63(å·²é€€æ¬¾2974.66)`ï¼‰ï¼Œéœ€æ­£åˆ™æå–

### ç¾å›¢ â€” CSV Â· 4 å­£åº¦æ–‡ä»¶ï¼ˆV6 æ–°å¢ï¼‰

- å‰çº¦ 19 è¡Œå…ƒæ•°æ®ä¸æç¤ºï¼ˆä»¥ `ã€ç¾å›¢äº¤æ˜“è´¦å•æ˜ç»†åˆ—è¡¨ã€‘` è¡Œä½œä¸ºè¡¨å¤´å®šä½æ ‡å¿—ï¼‰ï¼Œå…¶ä¸‹ä¸€è¡Œä¸ºçœŸæ­£è¡¨å¤´
- å­—æ®µï¼šäº¤æ˜“åˆ›å»ºæ—¶é—´ / äº¤æ˜“æˆåŠŸæ—¶é—´ / **äº¤æ˜“ç±»å‹**ï¼ˆæ”¯ä»˜/é€€æ¬¾/è¿˜æ¬¾ï¼‰/ **è®¢å•æ ‡é¢˜** / **æ”¶/æ”¯** / æ”¯ä»˜æ–¹å¼ / è®¢å•é‡‘é¢ / **å®ä»˜é‡‘é¢**ï¼ˆå¸¦ `Â¥`ï¼‰/ äº¤æ˜“å•å· / å•†å®¶å•å· / å¤‡æ³¨
- **æ— æ¶ˆè´¹åˆ†ç±»**ï¼Œéœ€ LLM æ‰“æ ‡
- æ–‡ä»¶åä¸º `ç¾å›¢è´¦å•(YYYYMMDD-YYYYMMDD).csv`ï¼Œå­£åº¦åˆ†æ–‡ä»¶ï¼Œéœ€åˆå¹¶è¯»å–

---

## äºŒã€é€€æ¬¾å¯¹å†²ï¼ˆæ¯å¹³å°ç‹¬ç«‹ï¼‰

### æ”¯ä»˜å®ï¼šè®¢å•å·æ‹†åˆ†æ³•ï¼ˆå·²å®ç°ï¼‰

é€€æ¬¾è®°å½•çš„è®¢å•å·ç”¨ `_` æˆ– `*` æ‹¼æ¥åŸå§‹è®¢å•å·ï¼Œæ‹†åˆ†åç²¾ç¡®åŒ¹é…ã€‚

- **å…¨é¢é€€æ¬¾**ï¼ˆ29 ç¬”ï¼‰ï¼šåŸå§‹çŠ¶æ€ = `äº¤æ˜“å…³é—­` â†’ `effective = 0`
- **éƒ¨åˆ†é€€æ¬¾**ï¼ˆ9 ç¬”ï¼‰ï¼šåŸå§‹çŠ¶æ€ = `äº¤æ˜“æˆåŠŸ` â†’ `effective = original âˆ’ refund`
- **æœªåŒ¹é…**ï¼ˆ3 ç¬”ï¼‰ï¼šè·¨å¹´é€€æ¬¾æˆ–ä¿é™©é€€ä¿ï¼Œ`æ”¶/æ”¯ = ä¸è®¡æ”¶æ”¯`ï¼Œç›´æ¥å½’å…¥ cashflow
- é€€æ¬¾è¡Œæœ¬èº«æ ‡è®° `is_ignored = True`

### å¾®ä¿¡ï¼šçŠ¶æ€è‡ªæè¿°æ³•ï¼ˆå·²å®ç°ï¼‰

ä¸éœ€è¦åå‘æŸ¥æ‰¾ã€‚ç›´æ¥è¯»åŸå§‹æ”¯å‡ºçš„ `å½“å‰çŠ¶æ€` å­—æ®µï¼š

| çŠ¶æ€ | å¤„ç† |
|---|---|
| `å·²å…¨é¢é€€æ¬¾` | `effective = 0` |
| `å·²é€€æ¬¾(ï¿¥XX.XX)` | `effective = amount âˆ’ XX.XX` |
| `æ”¯ä»˜æˆåŠŸ` / `å¯¹æ–¹å·²æ”¶é’±` ç­‰ | `effective = amount` |

é€€æ¬¾æ”¶å…¥è¡Œï¼ˆ`äº¤æ˜“ç±»å‹ = 'XXX-é€€æ¬¾'`ï¼‰æ ‡è®° `is_ignored = True`ã€‚

### äº¬ä¸œï¼šé‡‘é¢å†…è”æ­£åˆ™æ³•ï¼ˆV6 æ–°å¢ï¼‰

äº¬ä¸œçš„é€€æ¬¾ä¿¡æ¯**å†…åµŒåœ¨æ”¯å‡ºè®°å½•çš„é‡‘é¢å­—æ®µä¸­**ï¼Œè€Œéç‹¬ç«‹é€€æ¬¾è¡Œå…³è”ï¼š

| é‡‘é¢å­—æ®µæ ¼å¼ | è§£æè§„åˆ™ |
|---|---|
| `293.10(å·²å…¨é¢é€€æ¬¾)` | `effective = 0` |
| `2977.63(å·²é€€æ¬¾2974.66)` | `effective = 2977.63 âˆ’ 2974.66 = 2.97`  |
| `375.00` ï¼ˆçº¯æ•°å­—ï¼‰ | `effective = 375.00` |

æ­¤å¤–ï¼Œç‹¬ç«‹çš„é€€æ¬¾è¡Œï¼ˆ`äº¤æ˜“çŠ¶æ€` = `é€€æ¬¾æˆåŠŸ`ï¼‰æ ‡è®° `is_ignored = True`ï¼Œä¸é‡å¤è®¡å…¥ã€‚

### ç¾å›¢ï¼šç‹¬ç«‹é€€æ¬¾è¡ŒæŠµæ‰£æ³•ï¼ˆV6 æ–°å¢ï¼‰

ç¾å›¢çš„é€€æ¬¾ä»¥ç‹¬ç«‹çš„ `äº¤æ˜“ç±»å‹ = é€€æ¬¾` è¡Œå­˜åœ¨ï¼Œ`æ”¶/æ”¯` = `æ”¶å…¥`ï¼š

- é€€æ¬¾è¡Œçš„ `effective_amount` èµ‹å€¼ä¸ºå…¶é‡‘é¢çš„**è´Ÿæ•°**ï¼Œç”±æ±‡æ€»æ—¶è‡ªç„¶æŠµæ¶ˆã€‚
- é€€æ¬¾è¡Œæ ‡è®° `is_ignored = True`ã€‚
- åŸå§‹æ”¯å‡ºè¡Œä¿ç•™åŸé‡‘é¢ä¸ä¿®æ”¹ï¼Œå› ä¸ºç¾å›¢é€€æ¬¾è¡Œä¸æ”¯å‡ºè¡Œä¹‹é—´æ²¡æœ‰å¯é çš„è®¢å•å·å…³è”ï¼ˆé€€æ¬¾è¡Œçš„å•†å®¶å•å·æ ¼å¼ä¸ä¸€è‡´ï¼‰ã€‚

---

## ä¸‰ã€åŒè½¨åˆ†æµ

### æ”¯ä»˜å®ï¼ˆå·²å®ç°ï¼‰

| æ¡ä»¶ | è½¨é“ |
|---|---|
| `æ”¶/æ”¯ = ä¸è®¡æ”¶æ”¯` | cashflow |
| `äº¤æ˜“åˆ†ç±» âˆˆ {è½¬è´¦çº¢åŒ…, æŠ•èµ„ç†è´¢, ä¿¡ç”¨å€Ÿè¿˜, æ”¶å…¥}` | cashflow |
| `äº¤æ˜“åˆ†ç±» = é€€æ¬¾` | èµ°é€€æ¬¾å¯¹å†² |
| å…¶ä½™æ”¯å‡º | **consumption** |

### å¾®ä¿¡ï¼ˆå·²å®ç°ï¼‰

| äº¤æ˜“ç±»å‹ | è½¨é“ |
|---|---|
| `å•†æˆ·æ¶ˆè´¹` | consumption |
| `æ‰«äºŒç»´ç ä»˜æ¬¾` + çŠ¶æ€=`æ”¯ä»˜æˆåŠŸ` | consumption |
| `æ‰«äºŒç»´ç ä»˜æ¬¾` + çŠ¶æ€=`å·²è½¬è´¦` | cashflow |
| `è½¬è´¦ / å¾®ä¿¡çº¢åŒ… / äºŒç»´ç æ”¶æ¬¾ / ç¾¤æ”¶æ¬¾ / è½¬å…¥é›¶é’±é€š` | cashflow |
| `XXX-é€€æ¬¾` | èµ°é€€æ¬¾å¯¹å†² |

### äº¬ä¸œï¼ˆV6 æ–°å¢ï¼‰

| æ¡ä»¶ | è½¨é“ |
|---|---|
| `æ”¶/æ”¯` = `æ”¯å‡º` ä¸” `äº¤æ˜“çŠ¶æ€` â‰  `é€€æ¬¾æˆåŠŸ` | **consumption** |
| `æ”¶/æ”¯` = `ä¸è®¡æ”¶æ”¯`ï¼ˆç™½æ¡è¿˜æ¬¾ã€å°é‡‘åº“è½¬è´¦ã€é¢„æˆæƒå†»ç»“/è§£å†»ç­‰ï¼‰ | cashflow |
| `æ”¶/æ”¯` = `æ”¶å…¥`ï¼ˆå°é‡‘åº“çº¢åŒ…ç­‰ï¼‰ | cashflow |
| `äº¤æ˜“çŠ¶æ€` = `é€€æ¬¾æˆåŠŸ` | èµ°é€€æ¬¾å¯¹å†² |

### ç¾å›¢ï¼ˆV6 æ–°å¢ï¼‰

| æ¡ä»¶ | è½¨é“ |
|---|---|
| `äº¤æ˜“ç±»å‹` = `æ”¯ä»˜` ä¸” `æ”¶/æ”¯` = `æ”¯å‡º` | **consumption** |
| `äº¤æ˜“ç±»å‹` = `è¿˜æ¬¾`ï¼ˆç¾å›¢æœˆä»˜ä»£æ‰£è¿˜æ¬¾ï¼‰ | cashflow |
| `äº¤æ˜“ç±»å‹` = `é€€æ¬¾` | èµ°é€€æ¬¾å¯¹å†² |

---

## å››ã€L1 + L2 åˆ†ç±»ä½“ç³»

> ä» V4 çš„æ”¯ä»˜å®+å¾®ä¿¡åŸºç¡€æ”¶æ•›è€Œæ¥ï¼ŒV6 ä¸ºå…¼å®¹äº¬ä¸œç”µå•†å’Œç¾å›¢åŒåŸç”Ÿæ´»åœºæ™¯è¿›è¡Œäº†æ‰©å……ã€‚å¸¦ â­ ä¸º V6 æ–°å¢ L2ã€‚

| L1 ä¸€çº§åˆ†ç±» | L2 äºŒçº§åˆ†ç±» |
|---|---|
| **é¤é¥®ç¾é£Ÿ** | å¤–å–é…é€ Â· å ‚é£Ÿæ­£é¤ Â· å¿«é¤ç®€é¤ Â· å’–å•¡é¥®å“ Â· è‡ªåŠ¨å”®è´§/é›¶é£Ÿ Â· ç”Ÿé²œè¶…å¸‚ Â· çƒ˜ç„™ç”œç‚¹ |
| **äº¤é€šå‡ºè¡Œ** | é«˜é€Ÿ/ETC Â· ç½‘çº¦è½¦/æ‰“è½¦ Â· å…¬å…±äº¤é€š Â· æœºç¥¨ç«è½¦ç¥¨ Â· å…±äº«å•è½¦ |
| **çˆ±è½¦å…»è½¦** | åœè½¦è´¹ Â· æ–°èƒ½æºå……ç”µ Â· åŠ æ²¹ Â· è´­è½¦/è½¦è¾†è®¢å• Â· è½¦é™© Â· ç»´ä¿®ä¿å…» Â· æ´—è½¦ |
| **ä½æˆ¿ç‰©ä¸š** | æˆ¿ç§Ÿ Â· ç‰©ä¸šè´¹ Â· æ°´ç”µç‡ƒæ°” |
| **æ—¥ç”¨ç™¾è´§** | çº¿ä¸Šæ—¥æ‚ Â· çº¿ä¸‹è¶…å¸‚/ä¾¿åˆ©åº— Â· æ—¥åŒ–æ¸…æ´ Â· **é²œèŠ±ç»¿æ¤** â­ |
| **æœé¥°è£…æ‰®** | é‹é´ Â· æœè£… Â· ç®±åŒ…é…é¥° |
| **æ•°ç ç”µå™¨** | æ‰‹æœº/ç”µå­äº§å“ Â· ç”µè„‘åŠå…¬ Â· æ™ºèƒ½å®¶å±… |
| **å……å€¼ç¼´è´¹** | è¯è´¹æµé‡ Â· ä¼šå‘˜è®¢é˜… Â· æ°´ç”µç‡ƒæ°”ç¼´è´¹ |
| **æ–‡åŒ–ä¼‘é—²** | ç”µå½±æ¼”å‡º Â· ä¼šå‘˜/çŸ¥è¯†ä»˜è´¹ Â· ä¹¦ç± Â· æŒ‰æ‘©/ä¼‘é—² Â· æ–‡åˆ›/ç©å…· Â· **è¿åŠ¨å¥èº«** â­ |
| **åŒ»ç–—å¥åº·** | è¯å“ Â· å°±åŒ»/ä½“æ£€ Â· **ä¿å¥å“/å™¨æ¢°** â­ |
| **ç¾å®¹ç¾å‘** | ç¾å‘ Â· ç¾å®¹æŠ¤è‚¤ Â· **ç¾å¦†ä¸ªæŠ¤** â­ |
| **å•†ä¸šæœåŠ¡** | ETC åŠç† Â· å¿«é€’å¯„ä»¶ Â· ä»¥æ—§æ¢æ–° Â· æ‰“å°/åŠè¯ |
| **ç”Ÿæ´»æœåŠ¡** | å¿«é€’ Â· æ‰“å° Â· å®¶æ”¿ |
| **é…’åº—æ—…æ¸¸** | é…’åº—ä½å®¿ Â· æ™¯åŒºé—¨ç¥¨ Â· æŠ¤ç…§ç­¾è¯ Â· æ—…è¡Œä¿é™© Â· æ—…è¡Œå›¢è´¹/å¥—é¤ Â· å¯¼æ¸¸/æ¸¸ç©é¡¹ç›® Â· æ—…æ¸¸æ‚è´¹ Â· æœºç¥¨ç«è½¦ç¥¨ Â· ç§Ÿè½¦ |
| **æ¯å©´äº²å­** | ç©å…· Â· æ¯å©´ç”¨å“ |
| **å®¶å±…å®¶è£…** | å®¶å…· Â· äº”é‡‘å»ºæ |
| **ä¿é™©** | äººå¯¿ä¿é™© Â· è´¢äº§ä¿é™© |
| **å…¬å…±æœåŠ¡** | æ”¿åºœç¼´è´¹ Â· å…¬å…±è®¾æ–½ |
| **å…¶ä»–** | æœªåˆ†ç±» |

> [!TIP]
> æ”¯ä»˜å®æœ‰äº›åŸå§‹åˆ†ç±»æœ‰è¯¯ï¼ˆå¦‚"ç§‘æ‹“åœè½¦è´¹"è¢«æ”¯ä»˜å®å½’å…¥"æ•°ç ç”µå™¨"ï¼‰ï¼Œäº¬ä¸œä¹Ÿå­˜åœ¨ç±»ä¼¼æƒ…å†µï¼ˆå¦‚æŒ‰æ‘©ä»ªè¢«æ ‡ä¸º"ç¾å¦†ä¸ªæŠ¤"ï¼‰ã€‚LLM ç»Ÿä¸€æ‰“æ ‡æ—¶ä¼šæ ¹æ®å•†æˆ·å+å•†å“æè¿°**çº æ­£**è¿™äº›é”™è¯¯ï¼Œè€Œéç…§æ¬ä»»ä½•å¹³å°çš„åŸå§‹åˆ†ç±»ã€‚

---

## äº”ã€LLM æ‰“æ ‡

> [!IMPORTANT]
> **V6 æ ¸å¿ƒå†³ç­–ï¼šæ‰€æœ‰å¹³å°ç»Ÿä¸€èµ° LLM æ‰“æ ‡**ï¼Œä¸å†åŒºåˆ†"å¼ºæ˜ å°„"å’Œ"LLM"ä¸¤æ¡è·¯å¾„ã€‚æ— è®ºæ”¯ä»˜å®ã€å¾®ä¿¡ã€äº¬ä¸œè¿˜æ˜¯ç¾å›¢ï¼ŒL1 å’Œ L2 å‡ç”± LLM æ ¹æ®äº¤æ˜“å¯¹æ–¹ + å•†å“æè¿° + é‡‘é¢ ç»Ÿä¸€åˆ¤å®šã€‚è¿™ä¿è¯äº†è·¨å¹³å°åˆ†ç±»çš„ä¸€è‡´æ€§ï¼Œä¹Ÿé¿å…äº†å¹³å°åŸå§‹åˆ†ç±»æœ‰è¯¯æ—¶äº§ç”Ÿçš„é”™è¯¯ä¼ æ’­ã€‚

**èŒƒå›´**ï¼šæ‰€æœ‰å››ä¸ªå¹³å°çš„ consumption è½¨è®°å½•

**æµç¨‹**ï¼šæ‰¹é‡ 20 æ¡ä¸€ç»„ï¼Œç”± Agent è‡ªèº«ä½œä¸º LLM æ‰§è¡Œã€‚

**Prompt**ï¼ˆå››å¹³å°é€šç”¨ï¼‰ï¼š

```
ä½ æ˜¯è´¢åŠ¡åˆ†ç±»ä¸“å®¶ã€‚è¯·ä¸ºä»¥ä¸‹æ”¯ä»˜äº¤æ˜“æ‰“ä¸Š L1 ä¸€çº§åˆ†ç±»å’Œ L2 äºŒçº§åˆ†ç±»ã€‚
å¿…é¡»ä»ä»¥ä¸‹å›ºå®šæ¸…å•ä¸­é€‰æ‹©ï¼š
[é¤é¥®ç¾é£Ÿ: å¤–å–é…é€/å ‚é£Ÿæ­£é¤/å¿«é¤ç®€é¤/å’–å•¡é¥®å“/è‡ªåŠ¨å”®è´§é›¶é£Ÿ/ç”Ÿé²œè¶…å¸‚/çƒ˜ç„™ç”œç‚¹]
[äº¤é€šå‡ºè¡Œ: é«˜é€ŸETC/ç½‘çº¦è½¦æ‰“è½¦/å…¬å…±äº¤é€š/æœºç¥¨ç«è½¦ç¥¨/å…±äº«å•è½¦]
[çˆ±è½¦å…»è½¦: åœè½¦è´¹/æ–°èƒ½æºå……ç”µ/åŠ æ²¹/è´­è½¦è½¦è¾†è®¢å•/è½¦é™©/ç»´ä¿®ä¿å…»/æ´—è½¦]
[ä½æˆ¿ç‰©ä¸š: æˆ¿ç§Ÿ/ç‰©ä¸šè´¹/æ°´ç”µç‡ƒæ°”]
[æ—¥ç”¨ç™¾è´§: çº¿ä¸Šæ—¥æ‚/çº¿ä¸‹è¶…å¸‚ä¾¿åˆ©åº—/æ—¥åŒ–æ¸…æ´/é²œèŠ±ç»¿æ¤]
[æœé¥°è£…æ‰®: é‹é´/æœè£…/ç®±åŒ…é…é¥°]
[æ•°ç ç”µå™¨: æ‰‹æœºç”µå­äº§å“/ç”µè„‘åŠå…¬/æ™ºèƒ½å®¶å±…]
[å……å€¼ç¼´è´¹: è¯è´¹æµé‡/ä¼šå‘˜è®¢é˜…/æ°´ç”µç‡ƒæ°”ç¼´è´¹]
[æ–‡åŒ–ä¼‘é—²: ç”µå½±æ¼”å‡º/ä¼šå‘˜çŸ¥è¯†ä»˜è´¹/ä¹¦ç±/æŒ‰æ‘©ä¼‘é—²/æ–‡åˆ›ç©å…·/è¿åŠ¨å¥èº«]
[åŒ»ç–—å¥åº·: è¯å“/å°±åŒ»ä½“æ£€/ä¿å¥å“å™¨æ¢°]
[ç¾å®¹ç¾å‘: ç¾å‘/ç¾å®¹æŠ¤è‚¤/ç¾å¦†ä¸ªæŠ¤]
[å•†ä¸šæœåŠ¡: ETCåŠç†/å¿«é€’å¯„ä»¶/ä»¥æ—§æ¢æ–°/æ‰“å°åŠè¯]
[ç”Ÿæ´»æœåŠ¡: å¿«é€’/æ‰“å°/å®¶æ”¿]
[é…’åº—æ—…æ¸¸: é…’åº—ä½å®¿/æ™¯åŒºé—¨ç¥¨/æŠ¤ç…§ç­¾è¯/æ—…è¡Œä¿é™©/æ—…è¡Œå›¢è´¹å¥—é¤/å¯¼æ¸¸æ¸¸ç©é¡¹ç›®/æ—…æ¸¸æ‚è´¹/æœºç¥¨ç«è½¦ç¥¨/ç§Ÿè½¦]
[æ¯å©´äº²å­: ç©å…·/æ¯å©´ç”¨å“]
[å®¶å±…å®¶è£…: å®¶å…·/äº”é‡‘å»ºæ]
[ä¿é™©: äººå¯¿ä¿é™©/è´¢äº§ä¿é™©]
[å…¬å…±æœåŠ¡: æ”¿åºœç¼´è´¹/å…¬å…±è®¾æ–½]
[å…¶ä»–: æœªåˆ†ç±»]

æ¯æ¡æ ¼å¼: [åºå·]. [æ¥æºå¹³å°] | [äº¤æ˜“å¯¹æ–¹] | [å•†å“æè¿°] | [é‡‘é¢]
è¿”å› JSON: [{"index": 1, "l1": "é¤é¥®ç¾é£Ÿ", "l2": "å¤–å–é…é€"}, ...]
```

å„å¹³å°æä¾›ç»™ LLM çš„å­—æ®µï¼ˆä»…ä¾›åˆ¤æ–­å‚è€ƒï¼Œä¸èµ°æ˜ å°„ï¼‰ï¼š

| å¹³å° | äº¤æ˜“å¯¹æ–¹ | å•†å“æè¿° | è¾…åŠ©å‚è€ƒ |
|---|---|---|---|
| æ”¯ä»˜å® | `äº¤æ˜“å¯¹æ–¹` | `å•†å“è¯´æ˜` | `äº¤æ˜“åˆ†ç±»`ï¼ˆä»…å‚è€ƒï¼Œä¸å¯ç›´æ˜ ï¼‰ |
| å¾®ä¿¡ | `äº¤æ˜“å¯¹æ–¹` | `å•†å“` | â€” |
| äº¬ä¸œ | `å•†æˆ·åç§°` | `äº¤æ˜“è¯´æ˜` | `äº¤æ˜“åˆ†ç±»`ï¼ˆä»…å‚è€ƒï¼Œä¸å¯ç›´æ˜ ï¼‰ |
| ç¾å›¢ | ä»`è®¢å•æ ‡é¢˜`ä¸­æå–åº—é“ºå | `è®¢å•æ ‡é¢˜` | â€” |

---

## å…­ã€å¤šç”¨æˆ·

```python
USER_PROFILES = {
    "parko": {
        "display_name": "Parko",
        "aliases": ["Parko", "èµµé”¡ç››"],
        "alipay_account": "18211094248",
    },
}
```

ä»æ–‡ä»¶å…ƒæ•°æ®è‡ªåŠ¨åŒ¹é…ï¼ŒUUL è®°å½•å¸¦ `user_id`ã€‚

---

## ä¸ƒã€é¡¹ç›®ç»“æ„

```
SpendingAnalyser/
â”œâ”€â”€ å‚è€ƒææ–™/
â”œâ”€â”€ Implementation_Plan/
â”œâ”€â”€ data/                       # åŸå§‹ CSV/XLSX
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ parsers/
â”‚   â”‚   â”œâ”€â”€ base.py             # UUL Schema
â”‚   â”‚   â”œâ”€â”€ alipay.py           # GB2312 CSV parserï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ wechat.py           # XLSX parserï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ jd.py               # äº¬ä¸œ CSV parserï¼ˆV6 æ–°å¢ï¼‰
â”‚   â”‚   â””â”€â”€ meituan.py          # ç¾å›¢ CSV parserï¼ˆV6 æ–°å¢ï¼‰
â”‚   â”œâ”€â”€ cleaners/
â”‚   â”‚   â”œâ”€â”€ refund_netting.py   # å¹³å°ç‹¬ç«‹é€€æ¬¾é€»è¾‘
â”‚   â”‚   â””â”€â”€ non_consumption.py  # åŒè½¨åˆ†æµ
â”‚   â”œâ”€â”€ classifiers/
â”‚   â”‚   â”œâ”€â”€ taxonomy.py         # L1+L2 å›ºå®šæ¸…å•
â”‚   â”‚   â””â”€â”€ llm_tagger.py       # LLM æ‰“æ ‡æ¥å£
â”‚   â”œâ”€â”€ users.py                # å¤šç”¨æˆ·é…ç½®
â”‚   â”œâ”€â”€ api.py                  # Flask REST API
â”‚   â””â”€â”€ main.py                 # å…¥å£
â”œâ”€â”€ frontend/                   # Vite + Chart.js
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.js
â”‚   â”‚   â”œâ”€â”€ api.js              # è°ƒåç«¯ API
â”‚   â”‚   â”œâ”€â”€ charts.js           # å›¾è¡¨æ¸²æŸ“
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â””â”€â”€ vite.config.js
â”œâ”€â”€ tests/
â”œâ”€â”€ requirements.txt
â””â”€â”€ .gitignore
```

---

## å…«ã€Web UI é¡µé¢

1. **æ€»è§ˆå¡ç‰‡**ï¼šæ€»æ”¯å‡º Â· å‡€æ¶ˆè´¹ Â· é€€æ¬¾é¢ Â· éæ¶ˆè´¹è½¬ç§»é¢
2. **åˆ†ç±»é¥¼å›¾**ï¼šL1 é¥¼å›¾ï¼Œç‚¹å‡»ä¸‹é’» L2
3. **æ—¶é—´è¶‹åŠ¿**ï¼šæŠ˜çº¿/æŸ±çŠ¶å›¾ï¼Œåˆ‡æ¢å¹´/æœˆ/å‘¨
4. **Top å•†æˆ·**ï¼šæ¨ªå‘æŸ±çŠ¶å›¾
5. **æ˜ç»†è¡¨æ ¼**ï¼šæ’åº Â· æœç´¢ Â· æŒ‰å¹³å°/åˆ†ç±»/æ—¶é—´ç­›é€‰
6. **èµ„é‡‘æµåŠ¨é¢æ¿**ï¼ˆV1 ç®€ç‰ˆï¼‰ï¼šcashflow è½¨æ€»é¢ä¸å¤§ç±»å æ¯”

---

## ä¹ã€V6 å¢é‡å®æ–½ï¼šæœ€å°åŒ–æ”¹åŠ¨æ–¹æ¡ˆ

> [!NOTE]
> ä»¥ä¸‹æ–¹æ¡ˆåŸºäºå·²å®Œæˆçš„ V1 MVP ä»£ç ï¼ˆæ”¯ä»˜å® + å¾®ä¿¡å·²å®Œæ•´å®ç°ï¼šParserã€é€€æ¬¾å¯¹å†²ã€åŒè½¨åˆ†æµã€LLM æ‰“æ ‡ã€Web UI å‡å¯è¿è¡Œï¼‰ã€‚ç›®æ ‡æ˜¯åœ¨**ä¸ç ´åç°æœ‰ç¨‹åºè¿è¡Œ**çš„å‰æä¸‹ï¼Œä»¥æœ€å°æ”¹åŠ¨é‡æ¥å…¥äº¬ä¸œå’Œç¾å›¢ã€‚

### 9.1 æ–°å¢æ–‡ä»¶ï¼ˆä¸è§¦åŠä»»ä½•å·²æœ‰æ–‡ä»¶ï¼‰

| æ–°æ–‡ä»¶ | è¯´æ˜ |
|---|---|
| `src/parsers/jd.py` | äº¬ä¸œ Parserï¼šè·³è¿‡å‰ 21 è¡Œå…ƒæ•°æ® â†’ è¯»å– CSV â†’ é‡‘é¢æ­£åˆ™æå–é€€æ¬¾ â†’ æ˜ å°„è‡³ UUL Schema |
| `src/parsers/meituan.py` | ç¾å›¢ Parserï¼šå®šä½ `ã€ç¾å›¢äº¤æ˜“è´¦å•æ˜ç»†åˆ—è¡¨ã€‘` â†’ è¯»å–ä¸‹æ–¹æ•°æ® â†’ å»é™¤ `Â¥` â†’ æ˜ å°„è‡³ UUL Schema |

æ¯ä¸ª Parser çš„ `source_platform` å­—æ®µåˆ†åˆ«å†™å…¥ `"jd"` å’Œ `"meituan"`ï¼Œç¡®ä¿åç»­æµç¨‹å¯æŒ‰å¹³å°è¯†åˆ«ã€‚

### 9.2 æœ€å°ä¿®æ”¹å·²æœ‰æ–‡ä»¶

#### (a) `src/main.py`ï¼ˆåŠ æŒ‚æ–° Parser åˆ° pipelineï¼‰

åœ¨ Step 1 è§£æé˜¶æ®µï¼Œ**è¿½åŠ **äº¬ä¸œå’Œç¾å›¢çš„æ–‡ä»¶è¯†åˆ«ä¸è§£æï¼Œä¸ä¿®æ”¹å·²æœ‰çš„æ”¯ä»˜å®/å¾®ä¿¡é€»è¾‘ï¼š

```python
# åœ¨å·²æœ‰çš„ alipay/wechat å¯¼å…¥ä¹‹åè¿½åŠ 
from .parsers.jd import parse_jd
from .parsers.meituan import parse_meituan

# åœ¨ Step 1 çš„ dfs æ”¶é›†å¾ªç¯ä¸­è¿½åŠ ï¼š
# JD CSV files
for f in sorted(data_path.glob("äº¬ä¸œäº¤æ˜“æµæ°´*.csv")):
    print(f"  â†’ JD: {f.name}")
    df = parse_jd(str(f))
    dfs.append(df)

# Meituan CSV files
for f in sorted(data_path.glob("ç¾å›¢è´¦å•*.csv")):
    print(f"  â†’ Meituan: {f.name}")
    df = parse_meituan(str(f))
    dfs.append(df)
```

#### (b) `src/cleaners/refund_netting.py`ï¼ˆè¿½åŠ ä¸¤ä¸ªé€€æ¬¾å‡½æ•°ï¼‰

æ–°å¢ `_net_jd_refunds()` å’Œ `_net_meituan_refunds()` å‡½æ•°ï¼Œå¹¶åœ¨ `apply_refund_netting()` ä¸­è¿½åŠ è°ƒç”¨ï¼š

```python
df = _net_jd_refunds(df)
df = _net_meituan_refunds(df)
```

å·²æœ‰çš„ `_net_alipay_refunds()` å’Œ `_net_wechat_refunds()` å®Œå…¨ä¸åŠ¨ã€‚

#### (c) `src/cleaners/non_consumption.py`ï¼ˆè¿½åŠ ä¸¤ä¸ªåˆ†æµå‡½æ•°ï¼‰

æ–°å¢ `_classify_jd_track()` å’Œ `_classify_meituan_track()` å‡½æ•°ï¼Œå¹¶åœ¨ `apply_track_classification()` çš„ for å¾ªç¯ä¸­è¿½åŠ åˆ†æ”¯ï¼š

```python
elif row["source_platform"] == "jd":
    df.at[idx, "track"] = _classify_jd_track(row)
elif row["source_platform"] == "meituan":
    df.at[idx, "track"] = _classify_meituan_track(row)
```

å·²æœ‰çš„æ”¯ä»˜å®/å¾®ä¿¡åˆ†æµé€»è¾‘å®Œå…¨ä¸åŠ¨ã€‚

#### (d) `src/classifiers/taxonomy.py`ï¼ˆæ‰©å…… L2 åˆ†ç±»ï¼‰

åœ¨ `TAXONOMY` å­—å…¸ä¸­ä¸ºå¯¹åº”çš„ L1 è¿½åŠ æ–°çš„ L2 æ¡ç›®ï¼š

```diff
- "æ—¥ç”¨ç™¾è´§": ["çº¿ä¸Šæ—¥æ‚", "çº¿ä¸‹è¶…å¸‚/ä¾¿åˆ©åº—", "æ—¥åŒ–æ¸…æ´"],
+ "æ—¥ç”¨ç™¾è´§": ["çº¿ä¸Šæ—¥æ‚", "çº¿ä¸‹è¶…å¸‚/ä¾¿åˆ©åº—", "æ—¥åŒ–æ¸…æ´", "é²œèŠ±ç»¿æ¤"],

- "æ–‡åŒ–ä¼‘é—²": ["ç”µå½±æ¼”å‡º", "ä¼šå‘˜/çŸ¥è¯†ä»˜è´¹", "ä¹¦ç±", "æŒ‰æ‘©/ä¼‘é—²", "æ–‡åˆ›/ç©å…·"],
+ "æ–‡åŒ–ä¼‘é—²": ["ç”µå½±æ¼”å‡º", "ä¼šå‘˜/çŸ¥è¯†ä»˜è´¹", "ä¹¦ç±", "æŒ‰æ‘©/ä¼‘é—²", "æ–‡åˆ›/ç©å…·", "è¿åŠ¨å¥èº«"],

- "åŒ»ç–—å¥åº·": ["è¯å“", "å°±åŒ»/ä½“æ£€"],
+ "åŒ»ç–—å¥åº·": ["è¯å“", "å°±åŒ»/ä½“æ£€", "ä¿å¥å“/å™¨æ¢°"],

- "ç¾å®¹ç¾å‘": ["ç¾å‘", "ç¾å®¹æŠ¤è‚¤"],
+ "ç¾å®¹ç¾å‘": ["ç¾å‘", "ç¾å®¹æŠ¤è‚¤", "ç¾å¦†ä¸ªæŠ¤"],
```

åŒæ—¶ï¼ŒåºŸå¼ƒ `ALIPAY_L1_MAP` å’Œ `apply_alipay_l1_mapping()`ï¼ˆå› æ‰€æœ‰å¹³å°ç»Ÿä¸€èµ° LLMï¼‰ï¼Œå¹¶ç›¸åº”ç§»é™¤ `main.py` Step 4 ä¸­å¯¹å®ƒçš„è°ƒç”¨ã€‚

#### (e) `src/classifiers/llm_tagger.py`ï¼ˆPrompt æ›´æ–°ï¼‰

æ›´æ–° Prompt æ¨¡æ¿ä»¥è¦†ç›–æ–°å¢çš„ L2 åˆ†ç±»ï¼Œå¹¶åœ¨è¾“å…¥æ ¼å¼ä¸­åŠ å…¥ `[æ¥æºå¹³å°]` å­—æ®µï¼Œæ–¹ä¾¿ LLM åˆ©ç”¨å¹³å°è¯­å¢ƒè¾…åŠ©åˆ¤æ–­ã€‚

### 9.3 ä¸éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ç†ç”± |
|---|---|
| `src/parsers/base.py` | UUL Schema å·²é€šç”¨ï¼Œæ— éœ€æ”¹åŠ¨ |
| `src/parsers/alipay.py` | å·²å®Œæˆï¼Œä¸è§¦åŠ |
| `src/parsers/wechat.py` | å·²å®Œæˆï¼Œä¸è§¦åŠ |
| `src/api.py` | API å¯¹ DataFrame æ“ä½œæ˜¯é€šç”¨çš„ï¼Œä¸æ„ŸçŸ¥å…·ä½“å¹³å° |
| `src/users.py` | å¤šç”¨æˆ·é€»è¾‘ä¸å—å½±å“ |
| `frontend/*` | å‰ç«¯æŒ‰ç…§ L1/L2 å’Œ `source_platform` æ¸²æŸ“ï¼Œæ–°å¹³å°æ•°æ®è¿›å…¥åè‡ªåŠ¨å‘ˆç° |

### 9.4 æ”¹åŠ¨é‡æ€»ç»“

| ç±»å‹ | æ–‡ä»¶æ•° | æ”¹åŠ¨å¹…åº¦ |
|---|---|---|
| **æ–°å¢** | 2 | `jd.py` + `meituan.py`ï¼ˆçº¦ 150 è¡Œ/æ–‡ä»¶ï¼‰ |
| **è¿½åŠ é€»è¾‘** | 3 | `main.py` + `refund_netting.py` + `non_consumption.py`ï¼ˆå„è¿½åŠ  10-30 è¡Œï¼‰ |
| **å°å¹…ä¿®æ”¹** | 2 | `taxonomy.py`ï¼ˆ4 è¡Œ diffï¼‰ + `llm_tagger.py`ï¼ˆPrompt æ›´æ–°ï¼‰ |
| **ä¸åŠ¨** | 7+ | æ‰€æœ‰å‰ç«¯ã€APIã€Schemaã€ç°æœ‰ Parser |

---

## åã€æ‰§è¡Œæ­¥éª¤

| æ­¥éª¤ | å†…å®¹ | é¢„è®¡ | çŠ¶æ€ |
|---|---|---|---|
| 1 | æ­å»º Python é¡¹ç›® + `base.py` UUL Schema | å¿« | âœ… å·²å®Œæˆ |
| 2 | `alipay.py` + `wechat.py` è§£æå™¨ | ä¸­ | âœ… å·²å®Œæˆ |
| 3 | `refund_netting.py` é€€æ¬¾å¯¹å†² | ä¸­ | âœ… å·²å®Œæˆ |
| 4 | `non_consumption.py` åŒè½¨åˆ†æµ | å¿« | âœ… å·²å®Œæˆ |
| 5 | `taxonomy.py` L1+L2 æ¸…å• + `llm_tagger.py` | ä¸­ | âœ… å·²å®Œæˆ |
| 6 | `main.py` ä¸²è” + `api.py` REST æ¥å£ | ä¸­ | âœ… å·²å®Œæˆ |
| 7 | å‰ç«¯ Vite é¡¹ç›® + å›¾è¡¨ | è¾ƒé‡ | âœ… å·²å®Œæˆ |
| 8 | ç«¯åˆ°ç«¯æµ‹è¯• + éªŒè¯ï¼ˆæ”¯ä»˜å®+å¾®ä¿¡ï¼‰ | ä¸­ | âœ… å·²å®Œæˆ |
| **9** | **`jd.py` + `meituan.py` æ–° Parser** | **ä¸­** | ğŸ”œ å¾…å®æ–½ |
| **10** | **`refund_netting.py` + `non_consumption.py` è¿½åŠ äº¬ä¸œ/ç¾å›¢é€»è¾‘** | **å¿«** | ğŸ”œ å¾…å®æ–½ |
| **11** | **`taxonomy.py` æ‰©å…… + `llm_tagger.py` Prompt æ›´æ–°** | **å¿«** | ğŸ”œ å¾…å®æ–½ |
| **12** | **`main.py` æŒ‚è½½æ–° Parser + ç«¯åˆ°ç«¯éªŒè¯** | **ä¸­** | ğŸ”œ å¾…å®æ–½ |

---

## åä¸€ã€Verification Plan

### Automated Tests
```bash
python -m pytest tests/ -v
```
- Parserï¼šGB2312 / XLSX / äº¬ä¸œ CSV / ç¾å›¢ CSV è§£æã€å…ƒæ•°æ®è·³è¿‡ã€`Â¥` å»é™¤ã€é‡‘é¢æ­£åˆ™æå–ã€å­—æ®µæ˜ å°„
- é€€æ¬¾å¯¹å†²ï¼šæ”¯ä»˜å® `_`/`*` åˆ†å‰²ã€å¾®ä¿¡çŠ¶æ€è§£æã€äº¬ä¸œé‡‘é¢å†…è”æå–ã€ç¾å›¢é€€æ¬¾è¡Œæ ‡è®°
- åˆ†æµï¼šå››å¹³å°å„è‡ªåŒè½¨æ­£ç¡®åˆ†æµ

### Manual Verification
ç”¨çœŸå® 2025 æ•°æ®ç«¯åˆ°ç«¯è·‘é€šï¼Œç›®è§†æ ¸å¯¹ Web UI æŠ¥å‘Šã€‚é‡ç‚¹æ£€æŸ¥ï¼š
- äº¬ä¸œç™½æ¡è¿˜æ¬¾ã€é¢„æˆæƒç­‰æ˜¯å¦æ­£ç¡®è¿›å…¥ cashflow
- ç¾å›¢æœˆä»˜è¿˜æ¬¾æ˜¯å¦æ­£ç¡®è¿‡æ»¤
- æ–°å¢ L2 åˆ†ç±»ï¼ˆé²œèŠ±ç»¿æ¤ã€è¿åŠ¨å¥èº«ã€ä¿å¥å“/å™¨æ¢°ã€ç¾å¦†ä¸ªæŠ¤ï¼‰æ˜¯å¦è¢« LLM æ­£ç¡®ä½¿ç”¨
- å››å¹³å°æ¶ˆè´¹æ€»è®¡ä¸æ‰‹åŠ¨æŠ½æ ·æ ¸å¯¹ä¸€è‡´
